<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>人流量监管云平台</title>
    <script th:src="@{~/static/bootstrap/js/jquery-3.4.1.min.js}"></script>
    <link th:href="@{~/static/bootstrap/css/bootstrap.css}" rel="stylesheet"/>
    <script th:src="@{~/static/bootstrap/js/bootstrap.js}"></script>
    <link th:href="@{~/static/bootstrap/css/bootstrap.css}" rel="stylesheet"/>
    <link th:href="@{~/static/layui/css/layui.css}" rel="stylesheet"/>
    <!--<script th:src="@{~/static/layui/layui.all.js}"></script>-->
    <script th:src="@{~/static/layer/layer.js}"></script>

    <!--echarts插件-->
    <script th:src="@{~/static/echarts/echarts.min.js}"></script>
    <script th:src="@{~/static/echarts/esl.js}"></script>


</head>
<body>

<div class="container"><!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div class="rows">
        <div class="form-inline">
            <label>选择时间段:</label>
            <select id="project" name="project"
                    class="form-control">
                <option>实时人数</option>
                <option>最近24小时</option>
                <option>所有记录</option>
            </select>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6 col-md-8">
            <div id="main" style="width: 100%;height:400px;"></div>
        </div>
        <div class="col-sm-6 col-md-3">
            <img src="" id="cameraPhoto">
            当前人数为
        </div>
    </div>


</div>


</body>

<script type="text/javascript">
    var myChart = echarts.init(document.getElementById('main'));
    showdata()
    getCameraPhoto()

    setInterval("getCameraPhoto()", 50) //每隔0.1s更新一次

    function getCameraPhoto() {
        $.ajax({
            type: 'post',
            url: '/CameraPeople/CameraPhoto',
            async: false,
            data: {
                'camera_id': 1,
                'top_num': 1
            },
            success: function (data) {
                src = 'data:image/png;base64,' + data[0].image
                $('#cameraPhoto').attr('src', src)
            },
            error: function () {
                alert("error");
            }
        });
    }

    function showdata() {
        $.ajax({
            type: 'post',
            url: '/CameraPeople/allList',
            async: false,
            data: {
                'camera_id': 1,
                'top_num': 10
            },
            success: function (data) {
                // alert(data)
                xdata = []
                ydata = []
                peopleData = []
                temp = []
                for (var i = 0; i < data.length; i++) {
                    temp.push(data[i].time)
                    temp.push(data[i].num)
                    peopleData.push(temp)
                    temp = []
                }
                console.log(xdata.toString())
                console.log(ydata.toString())
                myChart.setOption({
                    title: {
                        text: '人群监控情况',
                        subtext: '数据来自xxx地区的2号摄像头',
                        x: 'center',
                        align: 'right'
                    },
                    xAxis: {
                        name: '时间',
                        type: 'category',
                        boundaryGap: false,
                        axisLine: {onZero: false},


                        axisLabel: {
                            interval: 0,
                            formatter: function (value) {
                                var ret = '';
                                var maxLength = 10;
                                var rowNum = Math.ceil(value.length / maxLength);
                                if (rowNum > 1) {
                                    for (var i = 0; i < rowNum; i++) {
                                        var temp = "";
                                        var start = i * maxLength;
                                        var end = start + maxLength;
                                        temp = value.substring(start, end) + "\n";
                                        ret += temp;
                                    }
                                    return ret;
                                } else {
                                    return value;
                                }
                            }
                        }


                    },
                    grid: {
                        //   left: '10%',
                        // top:'100',
                        bottom: '80'
                    },
                    yAxis: {
                        name: '人流量(人数)',
                        type: "value"
                    },
                    series: [{
                        name: '销量',
                        type: 'line',
                        data: peopleData
                    }],
                    toolbox: {
                        //  left: 'center',
                        orient: 'vertical',
                        right: 50,
                        top: 40,
                        feature: {
                            dataZoom: {
                                yAxisIndex: 'none'
                            },
                            restore: {},
                            saveAsImage: {}
                        }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            animation: false,
                            label: {
                                backgroundColor: '#505765'
                            }
                        },
                    },
                    dataZoom: [{
                        startValue: '2014-06-01'
                    }, {
                        type: 'inside'
                    }],
                });
            },
            error: function () {
                alert("error");
            }
        });
    }

    setInterval("showdata()", 100) //每隔0.1s更新一次

</script>

</html>